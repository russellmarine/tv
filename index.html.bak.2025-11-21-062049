<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="/favicon.png">
  <meta charset="UTF-8" />
  <title>Russell TV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      padding: 0;
      background: url("/background.png") no-repeat center center fixed;
      background-size: cover;
      background-color: #000;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #fff;
    }

    header {
      background: rgba(0,0,0,0.8);
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    header h1 {
      margin: 0;
      font-size: 1.2rem;
    }

    .mode-toggle {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .btn {
      padding: 0.35rem 0.8rem;
      border-radius: 999px;
      border: 1px solid #ffffff44;
      background: rgba(0,0,0,0.7);
      color: #fff;
      font-size: 0.85rem;
      cursor: pointer;
      white-space: nowrap;
    }

    .btn.active {
      background: #2e7dd7;
      border-color: #2e7dd7;
    }

    /* Give room for footer so content isn't hidden behind it */
    main {
      padding-bottom: 2.2rem;
      box-sizing: border-box;
    }

    #single-view,
    #grid-view {
      padding: 0.75rem;
      box-sizing: border-box;
    }

    #single-player-hls,
    #single-player-yt {
      width: 100%;
      height: calc(100vh - 140px);
      display: none;
      border-radius: 12px;
      background: #000;
      border: none;
      max-height: calc(100vh - 160px);
    }

    #grid-view {
      display: none;
    }

    .grid-wrapper {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-auto-rows: minmax(0, 1fr);
      gap: 0.75rem;
    }

    .grid-cell {
      position: relative;
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 0.5rem;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      gap: 0.35rem;
    }

    .grid-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      z-index: 2;
    }

    .grid-label {
      padding: 3px 6px;
      background: rgba(0,0,0,0.8);
      font-size: 0.75rem;
      border-radius: 4px;
    }

    .grid-select {
      font-size: 0.75rem;
      background: rgba(0,0,0,0.8);
      color: #fff;
      border-radius: 4px;
      border: 1px solid #ffffff44;
      padding: 2px 4px;
      cursor: pointer;
    }

    .grid-cell video,
    .grid-cell iframe {
      width: 100%;
      height: 100%;
      border-radius: 10px;
      background: #000;
      border: none;
      flex: 1;
    }

    .grid-cell .yt-container {
      width: 100%;
      height: 100%;
      border-radius: 10px;
      background: #000;
      border: none;
      flex: 1;
    }

    /* ----- INFO BAR FOOTER ----- */
    /* Desktop: static, can wrap and show everything */
    #info-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.9);
      color: #fff;
      font-size: 0.75rem;
      padding: 0.25rem 0.75rem;
      box-sizing: border-box;
      z-index: 1000;
    }

    /* Mobile: thin strip, horizontal scroll if needed */
    @media (max-width: 768px) {
      body {
        background-attachment: scroll;
      }

      header {
        padding: 0.5rem 0.75rem;
        flex-direction: column;
        align-items: flex-start;
      }

      header h1 {
        font-size: 1rem;
      }

      .btn {
        font-size: 0.8rem;
        padding: 0.3rem 0.7rem;
      }

      main {
        padding-bottom: 1.8rem;
      }

      #info-bar {
        font-size: 0.6rem;
        padding: 0.15rem 0.4rem;
        height: 1.6rem;
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>Russell TV</h1>
    <div id="dynamic-buttons" class="mode-toggle"></div>
    <div class="mode-toggle">
      <button id="btn-single" class="btn active">Single</button>
      <button id="btn-grid" class="btn">Grid (4)</button>
    </div>
  </header>

  <main>
    <!-- SINGLE VIEW -->
<section id="single-view">
  <div class="single-layout">
    <div class="single-video-card">
      <video id="single-player-hls" controls autoplay muted playsinline></video>
      <div id="single-player-yt" style="display:none;"></div>
    </div>
    <div class="single-side-panel" id="single-side-panel"></div>
  </div>
</section>
    <section id="grid-view">
      <div class="grid-wrapper">
        <!-- CELLS GENERATED DYNAMICALLY -->
      </div>
    </section>
  </main>

  <!-- LOAD CONFIG FIRST -->
  <script src="/config/channels.js"></script>

  <!-- HLS.js -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    // Single view DOM
    const singleView = document.getElementById("single-view");
    const gridView = document.getElementById("grid-view");
    const singleHLS = document.getElementById("single-player-hls");
    const singleYTContainer = document.getElementById("single-player-yt");

    const btnSingle = document.getElementById("btn-single");
    const btnGrid = document.getElementById("btn-grid");

    let hlsSingle = null;
    const hlsGrid = {};
    const YT_PLAYERS = {};

    function onYouTubeIframeAPIReady() {
      // API is ready; players are created lazily when needed.
    }

    function getYouTubeVideoId(url) {
      if (!url) return null;
      const idx = url.indexOf("/embed/");
      if (idx === -1) return null;
      let idPart = url.substring(idx + 7);
      const qIdx = idPart.indexOf("?");
      if (qIdx !== -1) idPart = idPart.substring(0, qIdx);
      return idPart;
    }

    function destroyYTPlayer(playerKey) {
      if (YT_PLAYERS[playerKey]) {
        try {
          YT_PLAYERS[playerKey].destroy();
        } catch (e) {
          console.warn("Error destroying YT player", playerKey, e);
        }
        delete YT_PLAYERS[playerKey];
      }
    }

    function createOrReplaceYTPlayer(container, playerKey, videoUrl) {
      const videoId = getYouTubeVideoId(videoUrl);
      if (!videoId) {
        console.warn("Could not parse YouTube video ID from URL:", videoUrl);
        return;
      }

      destroyYTPlayer(playerKey);

      container.innerHTML = "";
      const innerId = playerKey + "-inner";
      const inner = document.createElement("div");
      inner.id = innerId;
      inner.style.width = "100%";
      inner.style.height = "100%";
      container.appendChild(inner);

      function build() {
        if (window.YT && typeof YT.Player === "function") {
          const player = new YT.Player(innerId, {
            videoId: videoId,
            playerVars: {
              autoplay: 1,
              mute: 1,
              controls: 1,
              rel: 0,
              playsinline: 1
            },
            events: {
              onReady: (e) => {
                // Request at least 480p
                e.target.setPlaybackQuality("large");
              },
              onStateChange: (e) => {
                if (e.data === YT.PlayerState.PLAYING) {
                  e.target.setPlaybackQuality("large");
                }
              }
            }
          });
          YT_PLAYERS[playerKey] = player;
        } else {
          setTimeout(build, 100);
        }
      }

      build();
    }

    //------------------------------------------------------------------------
    // DYNAMIC BUTTONS (HEADER)
    //------------------------------------------------------------------------
    const headerBtnContainer = document.getElementById("dynamic-buttons");

    CHANNEL_ORDER.forEach(key => {
      const btn = document.createElement("button");
      btn.id = `btn-${key}`;
      btn.className = "btn";
      btn.textContent = CHANNELS[key].label;

      btn.addEventListener("click", () => {
        enterSingleMode();
        setSingleChannel(key);
      });

      headerBtnContainer.appendChild(btn);
    });

    function highlightHeaderButton(key) {
      const all = headerBtnContainer.querySelectorAll(".btn");
      all.forEach(b => b.classList.remove("active"));

      const active = document.getElementById(`btn-${key}`);
      if (active) active.classList.add("active");
    }

    //------------------------------------------------------------------------
    // SINGLE VIEW FUNCTIONS
    //------------------------------------------------------------------------
    function stopSingle() {
      if (hlsSingle) {
        hlsSingle.destroy();
        hlsSingle = null;
      }
      singleHLS.pause();
      singleHLS.removeAttribute("src");
      singleHLS.load();

      destroyYTPlayer("single");
      singleYTContainer.innerHTML = "";
      singleYTContainer.style.display = "none";
      singleHLS.style.display = "block";
    }

    function setSingleChannel(key) {
      const ch = CHANNELS[key];
      highlightHeaderButton(key);

      stopGrid();
      stopSingle();

      if (ch.type === "yt") {
        singleHLS.style.display = "none";
        singleYTContainer.style.display = "block";
        createOrReplaceYTPlayer(singleYTContainer, "single", ch.url);
      } else {
        singleYTContainer.style.display = "none";
        singleHLS.style.display = "block";

        if (Hls.isSupported()) {
          hlsSingle = new Hls({ lowLatencyMode: true });
          hlsSingle.loadSource(ch.url);
          hlsSingle.attachMedia(singleHLS);
        } else {
          singleHLS.src = ch.url;
        }
      }
    }

    function enterSingleMode() {
      btnSingle.classList.add("active");
      btnGrid.classList.remove("active");
      singleView.style.display = "block";
      gridView.style.display = "none";
      stopGrid();
    }

    //------------------------------------------------------------------------
    // GRID VIEW FUNCTIONS
    //------------------------------------------------------------------------
    function buildGrid() {
      const wrapper = gridView.querySelector(".grid-wrapper");

      wrapper.innerHTML = ""; // clear any stale content

      for (let cell = 1; cell <= 4; cell++) {
        const div = document.createElement("div");
        div.className = "grid-cell";
        div.dataset.cell = cell;

        const header = document.createElement("div");
        header.className = "grid-header";

        const label = document.createElement("div");
        label.className = "grid-label";
        label.id = `label-cell-${cell}`;
        header.appendChild(label);

        const sel = document.createElement("select");
        sel.className = "grid-select";
        sel.dataset.cell = cell;

        Object.keys(CHANNELS).forEach(key => {
          const opt = document.createElement("option");
          opt.value = key;
          opt.textContent = CHANNELS[key].label;
          sel.appendChild(opt);
        });

        sel.addEventListener("change", (e) => {
          const c = parseInt(e.target.dataset.cell);
          playGridCell(c, e.target.value);
        });

        header.appendChild(sel);
        div.appendChild(header);

        const vid = document.createElement("video");
        vid.id = `grid-video-${cell}`;
        vid.autoplay = true;
        vid.muted = true;
        vid.controls = true;
        vid.playsInline = true;
        vid.setAttribute("playsinline", "");

        const ytDiv = document.createElement("div");
        ytDiv.id = `grid-yt-${cell}`;
        ytDiv.className = "yt-container";
        ytDiv.style.display = "none";

        div.appendChild(vid);
        div.appendChild(ytDiv);

        wrapper.appendChild(div);
      }
    }

    function stopGrid() {
      for (let k in hlsGrid) {
        if (hlsGrid[k]) {
          hlsGrid[k].destroy();
          hlsGrid[k] = null;
        }
      }

      // Destroy all grid YT players
      Object.keys(YT_PLAYERS).forEach((key) => {
        if (key.startsWith("grid-")) {
          destroyYTPlayer(key);
        }
      });

      for (let cell = 1; cell <= 4; cell++) {
        const v = document.getElementById(`grid-video-${cell}`);
        const y = document.getElementById(`grid-yt-${cell}`);
        if (v) {
          v.pause();
          v.removeAttribute("src");
          v.load();
        }
        if (y) {
          y.innerHTML = "";
          y.style.display = "none";
        }
      }
    }

    function playGridCell(cell, key) {
      const ch = CHANNELS[key];
      const label = document.getElementById(`label-cell-${cell}`);
      const video = document.getElementById(`grid-video-${cell}`);
      const ytDiv = document.getElementById(`grid-yt-${cell}`);

      label.textContent = ch.label;

      // Reset old
      if (hlsGrid[cell]) {
        hlsGrid[cell].destroy();
        hlsGrid[cell] = null;
      }
      video.pause();
      video.removeAttribute("src");
      video.load();

      destroyYTPlayer(`grid-${cell}`);
      ytDiv.innerHTML = "";

      if (ch.type === "yt") {
        video.style.display = "none";
        ytDiv.style.display = "block";
        createOrReplaceYTPlayer(ytDiv, `grid-${cell}`, ch.url);
      } else {
        ytDiv.style.display = "none";
        video.style.display = "block";

        if (Hls.isSupported()) {
          const h = new Hls({ lowLatencyMode: true });
          h.loadSource(ch.url);
          h.attachMedia(video);
          hlsGrid[cell] = h;
        } else {
          video.src = ch.url;
        }
      }
    }

    function enterGridMode() {
      btnGrid.classList.add("active");
      btnSingle.classList.remove("active");

      singleView.style.display = "none";
      gridView.style.display = "block";

      stopSingle();

      for (let cell = 1; cell <= 4; cell++) {
        const defaultKey = GRID_DEFAULTS[cell];
        const selector = gridView.querySelector('select[data-cell="' + cell + '"]');
        if (selector) {
          selector.value = defaultKey;
        }
        playGridCell(cell, defaultKey);
      }
    }

    //------------------------------------------------------------------------
    // MODE BUTTON EVENTS
    //------------------------------------------------------------------------
    btnSingle.addEventListener("click", enterSingleMode);
    btnGrid.addEventListener("click", enterGridMode);

    //------------------------------------------------------------------------
    // INITIALIZE
    //------------------------------------------------------------------------
    window.addEventListener("load", () => {
      buildGrid();
      setSingleChannel("cbs");
    });
  </script>
  <script src="/config/time-config.js"></script>
  <script src="/config/weather-config.js"></script>
  <script src="/config/info-bar.js"></script>
  <script src="/config/time-config.js"></script>
  <script src="/config/weather-config.js"></script>
  <script src="/config/info-bar.js"></script>
</body>
</html>
<style>
.single-layout {
  display: flex;
  gap: 1rem;
  align-items: flex-start;
}
.single-video-card {
  flex: 0 1 70%;
  max-width: 960px;
  background: rgba(0,0,0,0.6);
  border-radius: 12px;
  padding: 0.5rem;
  box-sizing: border-box;
}
.single-side-panel {
  flex: 1;
  min-height: 200px;
  border-radius: 12px;
  border: 1px dashed rgba(255,255,255,0.12);
  background: rgba(0,0,0,0.25);
}
#single-player-hls,
#single-player-yt {
  width: 100%;
  aspect-ratio: 16/9;
  height: auto;
  border-radius: 12px;
}
@media (max-width: 768px) {
  .single-layout {
    flex-direction: column;
  }
  .single-side-panel {
    min-height: 120px;
  }
  #single-player-hls,
  #single-player-yt {
    max-height: 60vh;
  }
}
</style>
<style>
@media (max-width: 768px) {
  #info-bar {
    font-size: 0.6rem !important;
    padding: 0.15rem 0.35rem !important;
    height: 1.6rem !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    white-space: nowrap !important;
  }
}
</style>
<style>
@media (max-width: 768px) {
  #info-bar {
    font-size: 0.6rem !important;
    padding: 0.15rem 0.35rem !important;
    height: 1.6rem !important;
    overflow: hidden !important;
    white-space: nowrap !important;
  }
}
</style>

<script>
window.addEventListener('load', function () {
  var bar = document.getElementById('info-bar');
  if (!bar) return;

  // Wrap children in an inner div once
  var inner = document.getElementById('info-bar-inner');
  if (!inner) {
    inner = document.createElement('div');
    inner.id = 'info-bar-inner';

    while (bar.firstChild) {
      inner.appendChild(bar.firstChild);
    }

    // duplicate contents so the strip is long enough
    inner.innerHTML = inner.innerHTML + ' \u00A0 \u00B7 \u00A0 ' + inner.innerHTML;
    bar.appendChild(inner);
  }

  function isMobile() {
    return window.matchMedia &&
           window.matchMedia('(max-width: 768px)').matches;
  }

  var pos = 0;

  function step() {
    if (isMobile()) {
      var maxScroll = inner.scrollWidth - bar.clientWidth;

      if (maxScroll > 0) {
        pos += 0.5; // marquee speed (pixels per frame)
        if (pos > maxScroll + 20) {
          pos = 0;
        }
        bar.scrollLeft = pos;
      } else {
        bar.scrollLeft = 0;
      }
    } else {
      // desktop: keep static
      bar.scrollLeft = 0;
      pos = 0;
    }

    window.requestAnimationFrame(step);
  }

  window.requestAnimationFrame(step);
});
</script>
<style>
/* Mobile-only marquee footer */
#info-bar-mobile {
  display: none;              /* hidden on desktop */
}

/* Smooth marquee animation */
@keyframes infoBarTicker {
  0%   { transform: translateX(100%); }
  100% { transform: translateX(-100%); }
}

@media (max-width: 768px) {
  /* Hide the original static footer on mobile */
  #info-bar {
    display: none !important;
  }

  /* Show the mobile marquee bar */
  #info-bar-mobile {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.9);
    color: #fff;
    font-size: 0.6rem;
    height: 1.6rem;
    padding: 0.15rem 0.35rem;
    box-sizing: border-box;
    z-index: 1000;
    overflow: hidden;
    white-space: nowrap;
    display: block;
  }

  #info-bar-mobile-inner {
    display: inline-block;
    white-space: nowrap;
    padding-left: 100%;
    animation: infoBarTicker 90s linear infinite;
  }

  /* Optional: pause animation if someone long-presses / hovers */
  #info-bar-mobile:hover #info-bar-mobile-inner {
    animation-play-state: paused;
  }
}
</style>

<script>
window.addEventListener('load', function () {
  // Use the existing desktop footer as the source of truth
  var desktopBar = document.getElementById('info-bar');
  if (!desktopBar) return;

  // Don't create twice if we reload scripts, etc.
  if (document.getElementById('info-bar-mobile')) return;

  // Create a separate mobile footer
  var mobileBar = document.createElement('div');
  mobileBar.id = 'info-bar-mobile';

  var inner = document.createElement('div');
  inner.id = 'info-bar-mobile-inner';

  // Copy whatever info-bar.js rendered
  var content = desktopBar.innerHTML.trim();
  if (!content) return;

  // Duplicate content so the marquee can loop smoothly
  inner.innerHTML = content + ' \u00A0 \u00B7 \u00A0 ' + content;

  mobileBar.appendChild(inner);
  document.body.appendChild(mobileBar);
});
</script>
<style>
@media (max-width: 768px) {
  /* Make the marquee content a single horizontal row of pills */
  #info-bar-mobile-inner {
    display: inline-flex !important;
    flex-wrap: nowrap !important;
    align-items: center;
    gap: 1.2rem;
  }

  /* Each original block becomes a horizontal pill */
  #info-bar-mobile-inner > * {
    display: inline-flex !important;
    flex-direction: row !important;
    align-items: center;
    width: auto !important;
    margin: 0;
    padding: 0;
  }

  /* Kill line breaks inside the marquee so they don't stack */
  #info-bar-mobile-inner br {
    display: none !important;
  }
}
</style>
<style>
@media (max-width: 768px) {

  /* Faster startup hack */
  #info-bar-mobile-inner {
    animation-duration: 90s !important;       /* smooth slow speed */
    animation-delay: -10s !important;         /* jump-start the animation */
    will-change: transform;                   /* forces iOS to animate immediately */
  }

  /* Updated keyframes so the ticker doesn't sit offscreen forever */
  @keyframes infoBarTicker {
    0%   { transform: translateX(0%); }       /* start immediately */
    100% { transform: translateX(-100%); }    /* move left fully */
  }
}
</style>
<style>
@media (max-width: 768px) {
  /* Give the mobile ticker a bit more vertical room for two lines per tile */
  #info-bar-mobile {
    height: 2.1rem !important;
  }

  /* Let tiles keep their own internal layout (including stacked lines & colors) */
  #info-bar-mobile-inner {
    align-items: flex-start !important;
  }

  /* Allow line breaks again so you see both location and weather */
  #info-bar-mobile-inner br {
    display: inline !important;
  }

  /* Give each tile a little padding so background colors show nicely */
  #info-bar-mobile-inner > * {
    padding: 0 0.35rem !important;
  }
}
</style>
<script>
window.addEventListener('load', function () {
  var desktopBar = document.getElementById('info-bar');
  var mobileInner = document.getElementById('info-bar-mobile-inner');
  if (!desktopBar || !mobileInner) return;

  function syncMobileTicker() {
    var content = desktopBar.innerHTML.trim();
    if (content) {
      // Duplicate so the ticker can loop smoothly
      mobileInner.innerHTML = content + ' \u00A0 \u00B7 \u00A0 ' + content;
    }
    // Refresh every 60s in case weather/time updates
    setTimeout(syncMobileTicker, 60000);
  }

  // Give time/weather scripts a couple seconds to populate first
  setTimeout(syncMobileTicker, 3000);
});
</script>
<style>
@media (max-width: 768px) {
  /* Give more vertical room so tiles aren't cut off */
  #info-bar-mobile {
    height: 2.6rem !important;
  }

  /* Start at the first location, no random offset; keep a nice slow speed */
  #info-bar-mobile-inner {
    animation-duration: 70s !important;
    animation-delay: 0s !important;
  }
}

/* Ensure ticker animation definition is the "start at 0, move left" version */
@keyframes infoBarTicker {
  0%   { transform: translateX(0%); }
  100% { transform: translateX(-100%); }
}
</style>
<style>
@media (max-width: 768px) {
  /* Remove old padding that was pushing the ticker halfway across the screen */
  #info-bar-mobile-inner {
    padding-left: 0 !important;
  }
}
</style>
<style>
@media (max-width: 768px) {
  /* Default: no animation until we explicitly start it */
  #info-bar-mobile-inner {
    animation: none !important;
    padding-left: 0 !important;
  }

  /* Once ready, we add .ticker-running from JS to start a clean, slow scroll */
  #info-bar-mobile-inner.ticker-running {
    animation: infoBarTicker 70s linear infinite !important;
  }
}

/* Make sure keyframes are the "start at first tile, move left" version */
@keyframes infoBarTicker {
  0%   { transform: translateX(0%); }
  100% { transform: translateX(-100%); }
}
</style>

<script>
window.addEventListener('load', function () {
  var desktopBar = document.getElementById('info-bar');
  var mobileInner = document.getElementById('info-bar-mobile-inner');
  if (!desktopBar || !mobileInner) return;

  function startTickerWhenReady() {
    var content = desktopBar.innerHTML.trim();
    if (!content) {
      // Weather/time might not be drawn yet; try again shortly
      setTimeout(startTickerWhenReady, 1000);
      return;
    }

    // Build a smooth loop from the fully-rendered desktop footer
    mobileInner.innerHTML = content + ' \u00A0 \u00B7 \u00A0 ' + content;

    // Start animation cleanly from the first tile
    mobileInner.classList.add('ticker-running');
  }

  // Small delay so all other scripts (weather/time/info-bar) can run first
  setTimeout(startTickerWhenReady, 2000);
});
</script>
<style>
/* Desktop: show original buttons, hide mobile dropdown */
.channel-select-mobile-wrapper {
  display: none;
}

/* Mobile: hide many buttons, show compact dropdown */
@media (max-width: 768px) {
  #dynamic-buttons {
    display: none !important; /* hide all per-channel buttons on mobile */
  }

  .channel-select-mobile-wrapper {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .channel-select-mobile {
    background: rgba(0,0,0,0.8);
    color: #fff;
    border-radius: 999px;
    border: 1px solid #ffffff44;
    padding: 0.3rem 0.7rem;
    font-size: 0.8rem;
  }
}
</style>

<script>
window.addEventListener('load', function () {
  // Need header and your global channel config to be present
  if (!window.CHANNEL_ORDER || !window.CHANNELS) return;

  var header = document.querySelector('header');
  if (!header) return;

  // Avoid creating it twice if something reloads scripts
  if (document.getElementById('channel-select-mobile')) return;

  // Wrapper for mobile dropdown
  var wrapper = document.createElement('div');
  wrapper.className = 'channel-select-mobile-wrapper';

  var select = document.createElement('select');
  select.id = 'channel-select-mobile';
  select.className = 'channel-select-mobile';

  // Default placeholder option
  var defaultOpt = document.createElement('option');
  defaultOpt.value = '';
  defaultOpt.textContent = 'Select channel';
  select.appendChild(defaultOpt);

  // Fill options from CHANNEL_ORDER / CHANNELS
  CHANNEL_ORDER.forEach(function (key) {
    var ch = CHANNELS[key];
    if (!ch) return;
    var opt = document.createElement('option');
    opt.value = key;
    opt.textContent = ch.label;
    select.appendChild(opt);
  });

  wrapper.appendChild(select);

  // Insert just after the title in the header
  var title = header.querySelector('h1');
  if (title && title.parentNode === header) {
    header.insertBefore(wrapper, title.nextSibling);
  } else {
    header.insertBefore(wrapper, header.firstChild);
  }

  // Selecting a channel from mobile dropdown
  select.addEventListener('change', function (e) {
    var key = e.target.value;
    if (!key) return;
    if (typeof enterSingleMode === 'function') {
      enterSingleMode();
    }
    if (typeof setSingleChannel === 'function') {
      setSingleChannel(key);
    }
  });

  // Keep dropdown in sync when something else changes the channel
  if (typeof highlightHeaderButton === 'function') {
    var originalHighlight = highlightHeaderButton;
    highlightHeaderButton = function (key) {
      originalHighlight(key);
      var sel = document.getElementById('channel-select-mobile');
      if (sel) {
        sel.value = key || '';
      }
    };
  }
});
</script>
<style>
/* 1) Hide duplicate grid labels so you only see one picker per cell */
.grid-label {
  display: none !important;
}

/* 2) Desktop: shrink 2x2 grid so it fits better without vertical scrolling */
@media (min-width: 769px) {
  /* Slightly tighter padding in each grid cell */
  .grid-cell {
    padding: 0.35rem;
    max-height: 42vh; /* two rows ~84% of viewport height */
  }

  /* Let the video/iframe fill the shrunken cell without overflowing */
  .grid-cell video,
  .grid-cell iframe,
  .grid-cell .yt-container {
    height: 100%;
    max-height: 100%;
  }
}
</style>
<style>
/* Desktop-only grid video shrinking & centering */
@media (min-width: 769px) {

  /* Grid cell becomes a flexbox so the video centers perfectly */
  .grid-cell {
    display: flex !important;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  /* Shrink video/iframe to a nice centered “picture-in-grid” box */
  .grid-cell video,
  .grid-cell iframe,
  .grid-cell .yt-container {
    width: 85% !important;        /* adjust to preference: 70% / 80% / 90% */
    aspect-ratio: 16 / 9 !important;
    height: auto !important;
    object-fit: contain !important;  /* prevents black side bars */
    background: #000;                /* keeps clean letterbox look */
  }
}
</style>
<style>
@media (min-width: 769px) {

  /* Let the grid cell be mostly transparent */
  .grid-cell {
    background: transparent !important;
    padding: 0 !important;
    display: flex !important;
    justify-content: center;
    align-items: center;
  }

  /* Create a tight wrapper box just slightly larger than the video */
  .grid-video-wrapper {
    background: rgba(0,0,0,0.35);    /* subtle shading */
    padding: 0.4rem;                 /* the “slightly larger” effect */
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* Apply wrapper around all grid videos and iframes */
  .grid-cell video,
  .grid-cell iframe,
  .grid-cell .yt-container {
    width: 85% !important;
    aspect-ratio: 16/9 !important;
    height: auto !important;
    object-fit: contain !important;
    background: #000 !important;     /* clean letterbox interior */
  }
}
</style>

<script>
/* Wrap grid videos on load without breaking your player logic */
window.addEventListener('load', function () {
  for (let cell = 1; cell <= 4; cell++) {
    const cellDiv = document.querySelector('.grid-cell[data-cell="' + cell + '"]');
    if (!cellDiv) continue;

    // Skip if wrapper is already applied
    if (cellDiv.querySelector('.grid-video-wrapper')) continue;

    const vid = cellDiv.querySelector('video');
    const yt = cellDiv.querySelector('.yt-container');

    // Video wrapper div
    const wrap = document.createElement('div');
    wrap.className = 'grid-video-wrapper';

    // Determine which element to wrap
    let target = vid ? vid : yt;
    if (!target) continue;

    // Move target into wrapper
    target.parentNode.insertBefore(wrap, target);
    wrap.appendChild(target);
  }
});
</script>
<style>
@media (min-width: 769px) {
  /* Make grid cells vertical again: header on top, video box below */
  .grid-cell {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: flex-start !important;
    gap: 0.25rem !important;
  }

  /* Header stays full-width at the top of each cell */
  .grid-header {
    width: 100% !important;
    padding: 0.2rem 0.4rem 0 0.4rem !important;
    box-sizing: border-box;
    display: flex !important;
    align-items: center !important;
    justify-content: flex-end !important; /* label is hidden, so align select to the right */
  }

  /* Keep the tight shaded box just around the video wrapper */
  .grid-video-wrapper {
    margin-bottom: 0.15rem !important;
  }
}
</style>
<style>
@media (min-width: 769px) {
  /* shrink each grid cell a bit more so 2x2 fits above the footer */
  .grid-cell {
    max-height: 36vh !important;   /* was ~42vh; tweak if needed */
    padding-bottom: 0.1rem !important;
  }

  /* uniform, lighter shaded card behind every stream */
  .grid-video-wrapper {
    background: rgba(0,0,0,0.18) !important;  /* lighter tint so background shows */
    padding: 0.25rem !important;              /* tighter border around video */
    border-radius: 12px !important;
    width: 100% !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    box-sizing: border-box;
  }

  /* make sure all four streams share the same size and behavior */
  .grid-video-wrapper > video,
  .grid-video-wrapper > iframe,
  .grid-video-wrapper > .yt-container {
    width: 80% !important;                   /* uniform size for all sources */
    aspect-ratio: 16 / 9 !important;
    height: auto !important;
    object-fit: contain !important;
    background: #000 !important;
    border-radius: 8px !important;
  }
}
</style>
<style>
@media (min-width: 769px) {
  /* Reset the grid cell so it stops clipping and keeps a sane layout */
  .grid-cell {
    max-height: none !important;          /* no more cut-off */
    overflow: visible !important;         /* let the card fully show */
    padding: 0.25rem !important;
    display: flex !important;
    flex-direction: column !important;    /* header on top, card below */
    align-items: center !important;
    justify-content: flex-start !important;
    gap: 0.25rem !important;
  }

  /* Header full width, dropdown aligned right */
  .grid-header {
    width: 100% !important;
    padding: 0.15rem 0.35rem 0 0.35rem !important;
    box-sizing: border-box;
    display: flex !important;
    align-items: center !important;
    justify-content: flex-end !important;
  }

  /* Uniform, lighter card behind each stream */
  .grid-video-wrapper {
    background: rgba(0,0,0,0.15) !important;  /* lighter tint */
    padding: 0.3rem !important;               /* tight frame around stream */
    border-radius: 12px !important;
    width: 100% !important;
    box-sizing: border-box;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
  }

  /* Make sure ALL sources (HLS video or YT) are same size and behavior */
  .grid-video-wrapper > video,
  .grid-video-wrapper > iframe,
  .grid-video-wrapper > .yt-container {
    width: 75% !important;                   /* uniform size for all four */
    aspect-ratio: 16 / 9 !important;
    height: auto !important;
    object-fit: contain !important;
    background: #000 !important;
    border-radius: 8px !important;
  }
}
</style>
<style>
@media (min-width: 769px) {
  /* Grid cell: header on top, card below, no clipping */
  .grid-cell {
    max-height: none !important;
    overflow: visible !important;
    padding: 0.25rem !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: flex-start !important;
    gap: 0.25rem !important;
  }

  /* Header full-width, dropdown on the right */
  .grid-header {
    width: 100% !important;
    padding: 0.15rem 0.35rem 0 0.35rem !important;
    box-sizing: border-box;
    display: flex !important;
    align-items: center !important;
    justify-content: flex-end !important;
  }

  /* Light, tight card behind every stream (uniform across all 4) */
  .grid-video-wrapper {
    background: rgba(0,0,0,0.15) !important;
    padding: 0.3rem !important;
    border-radius: 12px !important;
    width: 100% !important;
    box-sizing: border-box;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
  }

  /* ALL sources (HLS video or YT) share the same sizing rules */
  .grid-video-wrapper > video,
  .grid-video-wrapper > iframe,
  .grid-video-wrapper > .yt-container {
    width: auto !important;
    max-height: 28vh !important;          /* two rows ≈ 56vh, so no vertical scroll */
    aspect-ratio: 16 / 9 !important;
    height: auto !important;
    object-fit: contain !important;
    background: #000 !important;
    border-radius: 8px !important;
  }
}
</style>

<script>
/* Normalize grid structure so each cell has ONE card wrapping BOTH stream types */
window.addEventListener('load', function () {
  for (let cell = 1; cell <= 4; cell++) {
    const cellDiv = document.querySelector('.grid-cell[data-cell="' + cell + '"]');
    if (!cellDiv) continue;

    const header = cellDiv.querySelector('.grid-header');
    if (!header) continue;

    // Find or create a shared wrapper
    let wrapper = cellDiv.querySelector('.grid-video-wrapper');
    if (!wrapper) {
      wrapper = document.createElement('div');
      wrapper.className = 'grid-video-wrapper';
      header.insertAdjacentElement('afterend', wrapper);
    }

    // Move BOTH the HLS video and the YT container into the same wrapper
    const vid = cellDiv.querySelector('video#grid-video-' + cell);
    const ytDiv = cellDiv.querySelector('#grid-yt-' + cell);

    if (vid && vid.parentNode !== wrapper) {
      wrapper.appendChild(vid);
    }
    if (ytDiv && ytDiv.parentNode !== wrapper) {
      wrapper.appendChild(ytDiv);
    }
  }
});
</script>
<style>
@media (min-width: 769px) {
  /* Light, tight card still the same, just clarifying width */
  .grid-video-wrapper {
    background: rgba(0,0,0,0.15) !important;
    padding: 0.3rem !important;
    border-radius: 12px !important;
    width: 100% !important;
    box-sizing: border-box;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
  }

  /* Let the video/iframe fill more width, and stop clamping height by vh */
  .grid-video-wrapper > video,
  .grid-video-wrapper > iframe,
  .grid-video-wrapper > .yt-container {
    width: 92% !important;          /* spreads out horizontally */
    max-height: none !important;    /* no more height clamp that caused bars */
    aspect-ratio: 16 / 9 !important;
    height: auto !important;
    object-fit: contain !important;
    background: #000 !important;
    border-radius: 8px !important;
  }
}
</style>
<style>
@media (min-width: 769px) {
  /* 2x2 grid that fits into the viewport (room for header + footer) */
  .grid-wrapper {
    height: calc(100vh - 150px); /* tweak 150px if your header/footer are larger/smaller */
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-auto-rows: 1fr;
    gap: 0.75rem;
  }

  /* Each cell: header on top, body fills the rest */
  .grid-cell {
    display: flex !important;
    flex-direction: column !important;
    align-items: stretch !important;
    justify-content: flex-start !important;
  }

  .grid-header {
    padding: 0.15rem 0.35rem 0 0.35rem !important;
    box-sizing: border-box;
    display: flex !important;
    align-items: center !important;
    justify-content: flex-end !important; /* just the dropdown */
  }

  .grid-body {
    flex: 1 1 auto;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0.15rem 0.35rem 0.35rem;
    box-sizing: border-box;
  }

  /* Ignore old wrappers we experimented with */
  .grid-video-wrapper {
    display: none !important;
  }

  /* Unified card behind each stream */
  .grid-frame {
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.15);
    border-radius: 12px;
    padding: 0.25rem;
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* HLS and YT both obey the same rules inside the frame */
  .grid-frame > video,
  .grid-frame > .yt-container,
  .grid-frame > iframe {
    width: 100%;
    max-width: 100%;
    aspect-ratio: 16 / 9;
    height: auto;
    object-fit: contain;
    background: #000;
    border-radius: 8px;
  }
}
</style>

<script>
/* Final normalize: same structure in every grid cell so sizing is uniform */
window.addEventListener('load', function () {
  for (let cell = 1; cell <= 4; cell++) {
    const cellDiv = document.querySelector('.grid-cell[data-cell="' + cell + '"]');
    if (!cellDiv) continue;

    // Skip if already normalized once
    if (cellDiv.querySelector('.grid-body')) continue;

    const header = cellDiv.querySelector('.grid-header');
    if (!header) continue;

    // Create body + frame
    const body = document.createElement('div');
    body.className = 'grid-body';

    const frame = document.createElement('div');
    frame.className = 'grid-frame';

    body.appendChild(frame);
    header.insertAdjacentElement('afterend', body);

    // Move the HLS video and YT container into the frame
    const vid = cellDiv.querySelector('video#grid-video-' + cell);
    const yt = cellDiv.querySelector('#grid-yt-' + cell);

    if (vid) frame.appendChild(vid);
    if (yt) frame.appendChild(yt);
  }
});
</script>
<style>
@media (min-width: 769px) {
  /* Let the grid height be natural, not forced */
  .grid-wrapper {
    height: auto !important;
  }

  /* Keep each cell as a simple vertical layout */
  .grid-cell {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: flex-start !important;
    padding: 0.25rem !important;
    gap: 0.25rem !important;
  }

  .grid-header {
    width: 100% !important;
    padding: 0.15rem 0.35rem 0 0.35rem !important;
    box-sizing: border-box;
    display: flex !important;
    align-items: center !important;
    justify-content: flex-end !important;
  }

  /* Card behind each stream – uniform & light */
  .grid-frame {
    width: 100% !important;
    background: rgba(0,0,0,0.15) !important;
    border-radius: 12px !important;
    padding: 0.25rem !important;
    box-sizing: border-box !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
  }

  /* Core: ALL sources share the same target size, based on viewport width */
  .grid-frame > video,
  .grid-frame > .yt-container,
  .grid-frame > iframe {
    width: 40vw !important;          /* two tiles per row: good compromise */
    max-width: 100% !important;
    aspect-ratio: 16 / 9 !important;
    height: auto !important;
    object-fit: contain !important;
    background: #000 !important;
    border-radius: 8px !important;
  }

  /* Make the YouTube container center its iframe properly */
  .grid-frame > .yt-container {
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
  }

  /* Ensure the actual YouTube iframe fills the yt-container box */
  .grid-frame iframe {
    width: 100% !important;
    height: 100% !important;
    border-radius: 8px !important;
    object-fit: contain !important;
  }
}
</style>
<style>
@media (min-width: 769px) {
  /* 1) Prevent the tiny extra box: hide any stray iframes directly under the grid cell */
  .grid-cell > iframe {
    display: none !important;
  }

  /* Make sure only the main stream elements are visible inside the card */
  .grid-frame > * {
    margin: 0 !important;
  }
  .grid-frame > video,
  .grid-frame > .yt-container,
  .grid-frame > iframe {
    display: block !important;
  }

  /* 2) Remove the tiny vertical scroll on desktop – TV UI should be full-screen */
  body {
    overflow-y: hidden !important;
  }
}
</style>
<style>
@media (min-width: 769px) {
  /* 1) Prevent the tiny extra box: hide any stray iframes directly under the grid cell */
  .grid-cell > iframe {
    display: none !important;
  }

  /* Make sure only the main stream elements are visible inside the card */
  .grid-frame > * {
    margin: 0 !important;
  }
  .grid-frame > video,
  .grid-frame > .yt-container,
  .grid-frame > iframe {
    display: block !important;
  }

  /* 2) Remove the tiny vertical scroll on desktop – TV UI should be full-screen */
  body {
    overflow-y: hidden !important;
  }
}
</style>
